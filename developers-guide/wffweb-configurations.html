<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link href='https://fonts.googleapis.com/css?family=Architects+Daughter'
	rel='stylesheet' type='text/css'>
<link rel="stylesheet" type="text/css"
	href="../stylesheets/stylesheet.css" media="screen">
<link rel="stylesheet" type="text/css"
	href="../stylesheets/github-light.css" media="screen">
<link rel="stylesheet" type="text/css" href="../stylesheets/print.css"
	media="print">

<!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<title>Developers Guide | Get Started</title>
<link rel="shortcut icon" href="../images/wffweb-logo.ico" type="image/x-icon">
</head>

<body>


	<header>
		<div class="inner">
			<h1>wffweb</h1>
			<h2>Java framework to develop web applications</h2>
			<a href="https://github.com/webfirmframework/tomcat-8-wffweb-demo-apps" class="button"><small>View sample projects on</small> GitHub</a>
		</div>
	</header>

	<div id="content-wrapper">
		<div class="inner clearfix">
			<section id="main-content">
				<h1>
					<a id="wffweb" class="anchor" href="#wffweb" aria-hidden="true"><span
						class="octicon octicon-link"></span></a>wffweb Configurations
				</h1>

                <p>Unlike other java ee frameworks, wffweb doesn't have any direct dependency over java ee classes.
                So, we have to configure wffweb if its server client communication feature needs to be used.
                 There are three main configurations. 
                 1. Configure websocket, 
                 2. set up a session listener and 
                 3. set up a <code>BrowserPage</code>.
                 Of course, once we have configured <code>BrowserPage</code>, 
                 we have to provide it by any servlet/rest.</p>
                
                <h5>1. Setting up websocket for wffweb</h5>

				<p>There must be a websocket url set up with your server, that
					websocket url should not be used by others. It should be dedicated
					for wffweb. The websocket should support sending and receiving
					binary data because wffweb and client communication is done via a
					binary protocol called wff binary message. when the websocket
					connection is opened, it must be informed to the wffweb as follows</p>

				<pre><code class="notranslate">List<String> wffInstanceIds = session.getRequestParameterMap().get("wffInstanceId");
String instanceId = wffInstanceIds.get(0);
BrowserPageContext.INSTANCE.webSocketOpened(instanceId);

browserPage.setWebSocketPushListener(new WebSocketPushListener() {

            @Override
            public void push(byte[] message) {
                try {
                    session.getBasicRemote()
                            .sendBinary(ByteBuffer.wrap(message));
                } catch (Exception e) {
                    e.printStackTrace();
                }
            }
        });
</code></pre>

The above code setting a listener so that wffweb can push messages. 
<br>
When the websocket is closed, it should be informed to wffweb as follows,

<pre><code class="notranslate">List<String> wffInstanceIds = session.getRequestParameterMap().get("wffInstanceId");
String instanceId = wffInstanceIds.get(0);
BrowserPageContext.INSTANCE.webSocketClosed(instanceId);
</code></pre> 

When the websocket receives a message, it should be forwarded to wffweb as follows.

<pre><code class="notranslate">List<String> wffInstanceIds = session.getRequestParameterMap().get("wffInstanceId");
String instanceId = wffInstanceIds.get(0);
BrowserPage browserPage = BrowserPageContext.INSTANCE.getBrowserPage(instanceId);
browserPage.websocketMessaged(message);
</code></pre> 

Here, <code>wffInstanceId</code> is a unique id generated by <code>BrowserPage</code> instance, it can be taken by <code>browserPage.getInstanceId</code> method.
Each instance of a <code>BrowserPage</code> will have its own unique <code>instanceId</code>.



<h5>2. Setting up session listener for wffweb</h5>
<p>
When the http session is closed, it must be informed to wffweb as follows.
</p>
<pre><code class="notranslate">@WebListener
public class SessionListener implements HttpSessionListener {

    @Override
    public void sessionCreated(HttpSessionEvent sessionEvent) {
        // NOP for wffweb
    }

    @Override
    public void sessionDestroyed(HttpSessionEvent sessionEvent) {
        BrowserPageContext.INSTANCE
                .httpSessionClosed(sessionEvent.getSession().getId());
    }

}
</code></pre>

<h5>3. Setting up <code>BrowserPage</code></h5>

<p><code>BrowserPage</code> represents UI page (window) of a browser. In a single page application, there will be only one <code>BrowserPage</code>.</p>
<pre><code>public class IndexPage extends BrowserPage {

    @Override
    public String webSocketUrl() {
        //the websocket url you have configured for wffweb
        return "ws://yourdomain.com/wffwebdemoproject/ws-for-index-page";
    }

    @Override
    public AbstractHtml render() {

        //keep this as a separate class so as to
        //change its different portion
        Html indexPageLayout = new Html(null) {{
          new Head(this);
          
          new Body(this) {{
           
              new Div(this) {{
                
                  new H1(this) {{
                      
                    new NoTag(this, "Hello WFFWEB");  
                    
                  }};
                  
              }};
              
          }};
          
        }};

        return indexPageLayout;
    }

}
</code></pre>

				<p>
					Whatever changes made to
					<code>indexPageLayout</code>
					will automatically be reflected to the client browser. So, we can
					keep it as a separate class for maintainability.
				</p>
				<p>
					Once we have created a
					<code>BrowserPage</code>
					, we have to add it to
					<code>BrowserPageContext</code>
					.
					<code>BrowserPageContext</code>
					is the context which holds all
					<code>BrowserPage</code>
					instances. Adding a
					<code>BrowserPage</code>
					instance in to
					<code>BrowserPageContext</code>
					may be done inside a servlet because we need to create instance of
					<code>BrowserPage</code>
					only when there is a request from new session. i.e. we need to have
					only one instance of the
					<code>IndexPage</code>
					per session. It may be added as follows
				</p>
				<pre><code>@WebServlet("/index")
public class IndexPageServlet extends HttpServlet {
    
    protected void doGet(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {

        response.setContentType("text/html;charset=utf-8");

        try (OutputStream os = response.getOutputStream();) {

            HttpSession session = request.getSession();

            String instanceId = (String) session
                    .getAttribute("indexPageInstanceId");

            BrowserPage browserPage = null;
            if (instanceId != null) {

                browserPage = BrowserPageContext.INSTANCE
                        .getBrowserPage(instanceId);

                // if the server is restarted browserPage could be null here,
                // so you could save this instance to db after addBrowserPage
                // method
                // and retried from db using browserPage.getInstanceId()

            }

            if (browserPage == null) {
                browserPage = new IndexPage();
                BrowserPageContext.INSTANCE.addBrowserPage(session.getId(),
                        browserPage);
                session.setAttribute("indexPageInstanceId",
                        browserPage.getInstanceId());
            }

            browserPage.toOutputStream(os, "UTF-8");
        }

    }

}</code></pre>

				<p>
					<a
						href="http://www.mochasupport.com/aff/idevaffiliate.php?id=6128&url=243">You
						can download a demo project from here</a>
				</p>
				<p>
					<a href="mltp-design-pattern.html">Next >></a>
				</p>



				<!-- <p>
					<a href="wffweb-configurations.html">Next >></a>
				</p> -->

				<p>
					For any technical assistance mail to <a
						href="mailto:tech-support@webfirmframework.com">tech-support@webfirmframework.com</a>
				</p>



				<br> <br> <br> <br>

				<p>
					Subscribe <a
						href="https://www.youtube.com/channel/UCQsPONDM3hfyas896Qyu74A">on
						youtube</a> for technical videos
				</p>
			</section>

			<aside id="sidebar">
				<a
					href="https://search.maven.org/remote_content?g=com.webfirmframework&a=wffweb&v=LATEST"
					class="button"> <small>Download</small> latest .jar file
				</a>
				<!--
           <a href="https://github.com/webfirmframework/wff/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>
 -->

				<p class="repo-owner">
					<a href="../index.html">Home</a>
				</p>

				<p class="repo-owner">
					<a href="get-started.html">Get Started</a>
				</p>
				
				<p class="repo-owner">
					<a href="wffweb-configurations.html">wff Configurations</a>
				</p>
				
				<p class="repo-owner">
					<a href="mltp-design-pattern.html">MLTP Design Pattern</a>
				</p>

				<p class="repo-owner">
					<a href="https://github.com/webfirmframework/wff">wffweb</a> is
					maintained by <a href="http://www.webfirmframework.com">webfirmframework</a>.
				</p>

				<p>
					Refer <a href="https://github.com/webfirmframework/wff/wiki">wiki</a>
					for code samples.
				</p>

				<p>
					Visit <a
						href="../wffweb/wffweb-javadoc/index.html"
						target="_blank">wffweb-javadoc</a> for java documentation.
				</p>

				<p>
					<a href="https://github.com/webfirmframework/wff/issues"
						target="_blank">Click here for feature request/bug report</a>.
				</p>
				<p>
					<a href="http://www.mochasupport.com/aff/idevaffiliate.php?id=6128&url=243" >Click here to download a demo project of wffweb with tomcat 8</a>.
				</p>


				<!-- 
          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>          
 -->
			</aside>
		</div>
	</div>
<footer style="text-align:center"><a href="http://webfirmframework.com">webfirmframework</a></footer>

</body>
</html>
